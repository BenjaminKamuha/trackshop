{% extends 'base.html' %}


{% block content %}

{% endblock %}

{% block sub_menu %}
    <h3>Historique de payment</h3>

    {% if purchase.payments.all %}
        {% for payment in purchase.payments.all %}
            <h4>{{ payment.created_at }}</h4>
            <p>{{ payment.amount }} <span> </span> {{ payment.currency.symbol }}</p>
        {% endfor %}

    {% else %}
        <p>Aucun paymenet pour la dette de {{ purchase.provider }}</p>
    {% endif %}
    
{% endblock %}

{% block form %}
    <div id="payment" style="padding: 10px;">
        <h3>Payment de {{ purchase.provider }}</h3>
        <div style="text-align: left; margin: 30px; border-bottom: 2px solid rgb(228, 93, 3);" id="purchase_summary">
            Date: {{ purchase.created_at }} <br>
            Montant total: {{  purchase.total_amount }} <span> </span> {{ purchase.currency.symbol }}<br>
            Total payé: {{ purchase.paid_amount }} <span> </span>{{ purchase.currency.symbol }}<br>
            Reste à payé: {{ purchase.balance }}<span> </span>{{ purchase.currency.symbol }}
        </div>

        <form
            action="{% url 'TrackShop:provider-payment' purchase.pk %}" method="POST">
            {% csrf_token %} 
            <label for="currency">Selectionner la Dévise: </label>
            <select id="currency_select" name="currency" id="" required>
                <option value="USD">USD</option>
                <option value="CDF">CDF</option>
            </select>
            Taux du jours: <input type="decimal" id="rate" readonly value="{{ rate }}"><br>
            <label for="amount">Montant : </label><input id="amount" type="number" name="amount" step="0.01" min="0.01" max="{{ purchase.balance }}" placeholder="0.00">
            <button type="submit" 
                >Valider</button>
        </form>
        <script>
            document.getElementById('currency_select').addEventListener('change', function(){
                const currency = document.getElementById('currency_select').value;
                if (currency === "CDF") {
                    document.getElementById('amount').max = {{ purchase.balance }} * {{ rate }};
                }
                else {
                    document.getElementById('amount').max = {{ purchase.balance }};
                }
            })
        </script>
    </div>
{% endblock %}


