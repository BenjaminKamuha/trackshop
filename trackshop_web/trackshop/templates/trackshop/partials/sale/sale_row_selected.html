<div class="product-row border border-1 border-gray-600 p-4 sm:p-5 rounded-lg space-y-4"
     id="prod{{ product.pk }}">

    <!-- Header -->
    <element id="header"
             class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 border-b border-green-600 pb-3">
        <h1 class="font-semibold">{{ product }}</h1>

        <button type="button"
                class="self-end sm:self-auto text-red-500"
                style="height: 30px;"
                onclick="this.closest('div').remove(); updateAddButton()">
            ❌
        </button>
    </element>

    <!-- Contenu en 2 colonnes responsive -->
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">

        <!-- Colonne gauche -->
        <div class="space-y-4">

            <!-- Quantité -->
            <div class="flex flex-col gap-1">
                <label for="quantity">Quantité</label>
                <input type="number"
                       name="quantity[]"
                       min="1"
                       max="{{ product.quantity }}"
                       id="quantity"
                       value="1"
                       class="h-9 px-3 py-2 border border-gray-500 rounded-md
                              focus:outline-none focus:border-2 focus:border-green-600
                              dark:bg-gray-800 dark:border-gray-600 dark:text-white w-full"
                       onchange="
                            const row = this.closest('.product-row');
                            const input_quantity = row.querySelector('#quantity').value;
                            const product_price = row.querySelector('#product_price').value;
                            const input_paid_amount = row.querySelector('#paid_amount')
                            var leftover_amount = row.querySelector('#leftover_amount');
                            const currency = document.getElementById('currency_select').value;
                            if (currency === 'CDF'){
                                input_paid_amount.value = (input_quantity * product_price).toFixed(2);
                                leftover_amount.value = ((input_quantity * product_price) - input_paid_amount.value).toFixed(2);
                            } 
                            else {
                                input_paid_amount.value = (input_quantity * product_price).toFixed(2);
                                leftover_amount.value = ((input_quantity * product_price) - input_paid_amount.value).toFixed(2);
                            }
                       "
                       onkeyup="
                            const row4 = this.closest('.product-row');
                            const input_quantity4 = row4.querySelector('#quantity').value;
                            const product_price4 = row4.querySelector('#product_price').value;
                            const input_paid_amount4 = row4.querySelector('#paid_amount')
                            var leftover_amount4 = row4.querySelector('#leftover_amount');
                            const currency4 = document.getElementById('currency_select').value;
                            if (currency4 === 'CDF'){
                                input_paid_amount4.value = (input_quantity4 * product_price4).toFixed(2);
                                leftover_amount.value = ((input_quantity4 * product_price4) - input_paid_amount4.value).toFixed(2);
                            } 
                            else {
                                input_paid_amount4.value = (4 * product_price4).toFixed(2);
                                leftover_amount.value = ((input_quantity4 * product_price4) - input_paid_amount4.value).toFixed(2);
                            }
                       ">
            </div>

            <!-- Montant payé -->
            <div class="flex flex-col gap-1">
                <label for="paid_amount">Montant payé</label>
                <div class="flex items-center gap-2">
                    <input id="paid_amount"
                           type="number"
                           step="0.01"
                           name="paidAmount[]"
                           min="0"
                           placeholder="0.00"
                           value="{{ product.price }}"
                           class="h-9 px-3 py-2 border border-gray-500 rounded-md
                                  focus:outline-none focus:border-2 focus:border-green-600
                                  dark:bg-gray-800 dark:border-gray-600 dark:text-white w-full"
                           onkeyup="
                                const row2 = this.closest('.product-row');
                                const input_quantity2 = row2.querySelector('#quantity').value;
                                const product_price2 = row2.querySelector('#product_price').value;
                                var leftover_amount = row2.querySelector('#leftover_amount');
                                const currency2 = document.getElementById('currency_select').value;
                                if (currency2 === 'CDF'){
                                    leftover_amount.value = ((product_price2 * input_quantity2) - this.value).toFixed(2);
                                    if (this.value > product_price2 * input_quantity2 * document.getElementById('rate').value){
                                        leftover_amount.value = 0;
                                        this.value = (product_price2 * input_quantity2 * document.getElementById('rate').value).toFixed(2);
                                    }
                                }
                                else {
                                    leftover_amount.value = ((product_price2 * input_quantity2) - this.value).toFixed(2);
                                    if (this.value > product_price2 * input_quantity2){
                                        leftover_amount.value = 0;
                                        this.value = (product_price2 * input_quantity2).toFixed(2);
                                    }
                                }
                           "
                           onchange="
                                const row3 = this.closest('.product-row');
                                const input_quantity3 = row3.querySelector('#quantity').value;
                                const product_price3 = row3.querySelector('#product_price').value;
                                var leftover_amount2 = row3.querySelector('#leftover_amount');
                                const currency3 = document.getElementById('currency_select').value;
                                if (currency3 === 'CDF') {
                                    leftover_amount2.value = (product_price3 * input_quantity3) - this.value;
                                    if (this.value > product_price3 * input_quantity3 * document.getElementById('rate').value){
                                        leftover_amount2.value = (0).toFixed(2);
                                        this.value = (product_price3 * input_quantity3 * document.getElementById('rate').value).toFixed(2);
                                    }
                                }
                                else {
                                    leftover_amount2.value = ((product_price3 * input_quantity3) - this.value).toFixed(2);
                                    if (this.value > product_price3 * input_quantity3){
                                        leftover_amount2.value = (0).toFixed(2);
                                        this.value = (product_price3 * input_quantity3).toFixed(2);
                                    }
                                }
                           ">
                    <span>$</span>
                </div>
            </div>

        </div>

        <!-- Colonne droite -->
        <div class="space-y-4">

            <!-- Prix -->
            <div class="flex flex-col gap-1">
                <label for="product_price">Prix</label>
                <div class="flex items-center gap-2">
                    <input readonly
                           id="product_price"
                           type="decimal"
                           name="productPrice"
                           value="{{ product.price }}"
                           class="h-9 px-3 py-2 border border-gray-400 rounded-md
                                  dark:bg-gray-800 dark:border-gray-600 dark:text-white w-full">
                    <span>$</span>
                </div>
            </div>

            <!-- Montant restant -->
            <div class="flex flex-col gap-1">
                <label for="leftover_amount">Montant restant</label>
                <div class="flex items-center gap-2">
                    <input id="leftover_amount"
                           type="number"
                           name="leftOver"
                           step="0.01"
                           min="0"
                           value="0"
                           readonly
                           class="h-9 px-3 py-2 border border-gray-400 rounded-md
                                  dark:bg-gray-800 dark:border-gray-600 dark:text-white w-full">
                    <span>$</span>
                </div>
            </div>

        </div>

    </div>

    <input type="hidden" name="product_id[]" value="{{ product.pk }}">

</div>